<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Å—Ç–æ–ª–∏–∫—ñ–≤ PRO</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .container { display: flex; gap: 20px; }
        .column { flex: 1; }
        
        .card { 
            border: 1px solid #ddd; padding: 15px; margin: 10px 0; 
            border-radius: 8px; background-color: #f9f9f9; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status { font-weight: bold; }
        .available { color: green; }
        .reserved { color: red; }
        
        input, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px;}
        button:hover { background-color: #0056b3; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>üçΩÔ∏è –°–∏—Å—Ç–µ–º–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É (K8s Edition)</h1>

    <div class="container">
        <div class="column">
            <h2>üè† –°—Ç–æ–ª–∏–∫–∏</h2>
            <button onclick="loadTables()">üîÑ –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ–ª–∏–∫–∏</button>
            <div id="tablesList"></div>
        </div>

        <div class="column">
            <h2>üìÖ –ó—Ä–æ–±–∏—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</h2>
            <div class="card">
                <input type="text" id="guestName" placeholder="–í–∞—à–µ —ñ–º'—è">
                <input type="number" id="tableId" placeholder="ID —Å—Ç–æ–ª–∏–∫–∞ (–Ω–∞–ø—Ä. 1)">
                <input type="date" id="dateInput">
                <button onclick="createReservation()">–ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏</button>
            </div>

            <h2>–°–ø–∏—Å–æ–∫ –±—Ä–æ–Ω—é–≤–∞–Ω—å</h2>
            <button onclick="loadReservations()">üîÑ –û–Ω–æ–≤–∏—Ç–∏ –±—Ä–æ–Ω—ñ</button>
            <div id="reservationsList"></div>
        </div>
    </div>

    <script>

        const API_URL = 'http://localhost:3005'; 

        async function loadTables() {
            const res = await fetch(`${API_URL}/tables`);
            const json = await res.json();
            const list = document.getElementById('tablesList');
            list.innerHTML = '';
            json.data.forEach(t => {
                list.innerHTML += `
                <div class="card">
                    <b>ID: ${t.id}</b> - ${t.name}<br>
                    –ú—ñ—Å—Ü—å: ${t.capacity} <br>
                    –°—Ç–∞—Ç—É—Å: <span class="${t.status}">${t.status}</span>
                </div>`;
            });
        }

        async function loadReservations() {
            const res = await fetch(`${API_URL}/reservations`);
            const json = await res.json(); 
            const list = document.getElementById('reservationsList');
            list.innerHTML = '';
            

            if(json.length === 0) {
                list.innerHTML = '<p>–ü–æ–∫–∏ –Ω–µ–º–∞—î –±—Ä–æ–Ω—é–≤–∞–Ω—å</p>';
                return;
            }

            json.forEach(r => {
                list.innerHTML += `
                <div class="card">
                    <b>–ë—Ä–æ–Ω—å #${r.id}</b><br>
                    –ì—ñ—Å—Ç—å: ${r.guestName}<br>
                    –°—Ç–æ–ª–∏–∫ ID: ${r.tableId}<br>
                    <button style="background-color:red" onclick="deleteReservation(${r.id})">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                </div>`;
            });
        }

        async function createReservation() {
            const name = document.getElementById('guestName').value;
            const tid = document.getElementById('tableId').value;
            
            if(!name || !tid) { alert("–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è —Ç–∞ ID —Å—Ç–æ–ª–∏–∫–∞!"); return; }

            const data = {
                tableId: parseInt(tid),
                guestName: name,
                startTime: document.getElementById('dateInput').value || new Date().toISOString()
            };

            try {
                const res = await fetch(`${API_URL}/reservations`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        // –î–æ–¥–∞—î–º–æ –∫–ª—é—á —ñ–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ (–ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å —è–∫ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID)
                        'Idempotency-Key': Date.now().toString() 
                    },
                    body: JSON.stringify(data)
                });
                
                if(res.ok) {
                    alert("–£—Å–ø—ñ—à–Ω–æ! ‚úÖ");
                    loadReservations();
                } else {
                    const err = await res.json();
                    alert("–ü–æ–º–∏–ª–∫–∞: " + JSON.stringify(err));
                }
            } catch(e) {
                alert("–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è: " + e);
            }
        }

        async function deleteReservation(id) {
            if(!confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')) return;
            await fetch(`${API_URL}/reservations/${id}`, { method: 'DELETE' });
            loadReservations();
        }

        loadTables();
        loadReservations();
    </script>
</body>
</html>